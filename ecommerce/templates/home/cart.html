{% extends "base.html" %}
{% load static %}
{% block content %}



  <main>
      <!-- Hero Area Start-->
      <div class="slider-area ">
          <div class="single-slider slider-height2 d-flex align-items-center">
              <div class="container">
                  <div class="row">
                      <div class="col-xl-12">
                          <div class="hero-cap text-center">
                              <h2>Cart List</h2>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <!--================Cart Area =================-->
      <section class="cart_area section_padding">
        <div class="container">
          <div class="cart_inner">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col">Product</th>
                    <th scope="col">Price</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Delete</th>
                  </tr>
                </thead>
                <tbody>
                  
                  <tr>
                    <td>
                      {% for i in cart %}
                      <div class="media">
                        <div class="d-flex">
                    
                          <img src= "{{i.product.product_image.url}}" alt="image" />
                                                
                        </div>
                        <div class="media-body">
                          <p> {{i.product.product_name}} </p>
                        </div>
                      </div>
                    </td>
                    <td>
                      <h5>$ {{i.product.product_price}} </h5>
                    </td>
                    
                    <td>
                      <div class="product_count">
                        <div>
                        <span class="changeQuantity" onclick="sub(this)"> <i class="ti-minus"></i></span>
                        <input class="" id="productcount"  type="text" value = "{{i.quantity}}">
                        <input type="hidden" id="productprice" value="{{i.product.product_price}}">
                        <input type="hidden" id="productid" value="{{i.product.id}}">
                        <span class="changeQuantity" onclick="add(this)"> <i class="ti-plus"></i></span>
                        <span id="totalprice" style="padding-left: 50px;">{{i.total_price}}</h5>
                        </div>
                      </div>
                      </td>
                      
                        
                        

                   <td>
                      <form method="POST" action="{% url 'delete_cart' i.id %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm">
                          Delete
                        </button>
                      </form>
                    </td>

                  </tr>
                  <tr>
                    <td>
                      {% endfor %}
                  </tr>
                  <tr class="bottom_button" method='POST'>
                    <td>
                      <a class="btn_1" href="#">Update Cart</a>
                    </td>
                    <td></td>
                    <td></td>
                    <td>
                      <div class="cupon_text float-right">
                        <a class="btn_1" href="#">Close Coupon</a>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td></td>
                    <td></td>
                    <td>
                      <h5>Subtotal</h5>
                    </td>
                    <td>
                      <h5>$ {{total_price}} </h5>
                    </td>
                  </tr>
                  <tr class="shipping_area">
                    <td></td>
                    <td></td>
                    <td>
                      <h5>Shipping</h5>
                    </td>
                    <td>
                      <div class="shipping_box">
                        <ul class="list">
                          <li>
                            Flat Rate: $5.00
                            <input type="radio" aria-label="Radio button for following text input">
                          </li>
                          <li>
                            Free Shipping
                            <input type="radio" aria-label="Radio button for following text input">
                          </li>
                          <li>
                            Flat Rate: $10.00
                            <input type="radio" aria-label="Radio button for following text input">
                          </li>
                          <li class="active">
                            Local Delivery: $2.00
                            <input type="radio" aria-label="Radio button for following text input">
                          </li>
                        </ul>
                        <h6>
                          Calculate Shipping
                          <i class="fa fa-caret-down" aria-hidden="true"></i>
                        </h6>
                        <select class="shipping_select">
                          <option value="1">Bangladesh</option>
                          <option value="2">India</option>
                          <option value="4">Pakistan</option>
                        </select>
                        <select class="shipping_select section_bg">
                          <option value="1">Select a State</option>
                          <option value="2">Select a State</option>
                          <option value="4">Select a State</option>
                        </select>
                        <input class="post_code" type="text" placeholder="Postcode/Zipcode" />
                        <a class="btn_1" href="#">Update Details</a>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
           
              <div class="checkout_btn_inner float-right">
                <a class="btn_1" href="#">Continue Shopping</a>
                <a class="btn_1 checkout_btn_1" href="{% url 'checkout' %}">Proceed to checkout</a>
              </div>
            </div>
          </div>
      </section>
      <!--================End Cart Area =================-->
  </main>



<!-- Error Modal -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="errorModalLabel">Messages</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <p id="errorMessage"></p>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
</div>

{% if messages %}
  <script>
      document.addEventListener('DOMContentLoaded', function () {
          // Check if there are error messages
          var errorMessages = "{% for message in messages %}{{ message }}{% endfor %}".trim();
          if (errorMessages !== "") {
              // Set the error message in the modal
              document.getElementById('errorMessage').textContent = errorMessages;

              // Show the error modal
              var errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
              errorModal.show();
          }
      });
  </script>
{% endif %}





<!-- SweetAlert CDN -->
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
      <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
      <script src="{% static ' js/main.js' %}"></script>
      <script>
        function add(button){
          var productcount = button.parentElement.querySelector('#productcount');
          var productid = button.parentElement.querySelector('#productid');
          var productprice = button.parentElement.querySelector('#productprice');
          var producttotal = button.parentElement.querySelector('#totalprice');
          var totalprice = parseInt(producttotal.innerHTML) + parseInt(productprice.value);
          var qty = parseInt(productcount.value)+1;
          var id = productid.value;
          $.ajax({
            method:"POST",
            url:"{% url 'update_cart' %}",
            data: {
              'product_count': qty,
              'product_id': id,
              'product_total':totalprice,
              csrfmiddlewaretoken: '{{csrf_token}}'
            },
            success: function(res){
              producttotal.innerHTML = `${parseInt(res.total)}`
            }
          })
          productcount.value = parseInt(productcount.value) + 1; 
        }
        function sub(button){
          var productcount = button.parentElement.querySelector('#productcount');
          var productid = button.parentElement.querySelector('#productid');
          var productprice = button.parentElement.querySelector('#productprice');
          var producttotal = button.parentElement.querySelector('#totalprice');
          var totalprice = parseInt(producttotal.innerHTML) - parseInt(productprice.value);
          var qty = parseInt(productcount.value)-1;
          var id = productid.value;
          $.ajax({
            method:"POST",
            url:"{% url 'update_cart' %}",
            data: {
              'product_count': qty,
              'product_id': id,
              'product_total':totalprice,
              csrfmiddlewaretoken: '{{csrf_token}}'
            },
            success: function(res){
              producttotal.innerHTML = `${parseInt(res.total)}`
            }
          })
          productcount.value = parseInt(productcount.value) - 1; 
        }
      </script>


{% endblock content %}